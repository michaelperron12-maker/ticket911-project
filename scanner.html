<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticket911 — Scanner AI 26 Agents</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #060a18;
            --bg-card: rgba(255,255,255,0.03);
            --border: rgba(255,255,255,0.07);
            --navy: #1e3a5f;
            --red: #e63946;
            --gold: #d4a843;
            --green: #22c55e;
            --purple: #7c3aed;
            --cyan: #06b6d4;
            --text: #e2e8f0;
            --text-dim: rgba(255,255,255,0.45);
            --glow-red: rgba(230,57,70,0.3);
            --glow-gold: rgba(212,168,67,0.3);
            --glow-green: rgba(34,197,94,0.3);
            --glow-purple: rgba(124,58,237,0.25);
            --glow-cyan: rgba(6,182,212,0.25);
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            min-height:100vh; font-family:'Inter',system-ui,sans-serif; color:var(--text);
            background: var(--bg-primary);
            overflow-x: hidden;
        }

        /* ═══ PARTICLE BACKGROUND ═══ */
        #particles-bg {
            position:fixed; inset:0; z-index:0; pointer-events:none;
            background: radial-gradient(ellipse at 20% 50%, rgba(30,58,95,0.15) 0%, transparent 60%),
                        radial-gradient(ellipse at 80% 20%, rgba(124,58,237,0.08) 0%, transparent 50%),
                        radial-gradient(ellipse at 50% 90%, rgba(230,57,70,0.06) 0%, transparent 50%);
        }
        .particle {
            position:absolute; border-radius:50%; pointer-events:none;
            animation: floatParticle linear infinite;
        }
        @keyframes floatParticle {
            0% { transform: translateY(0) translateX(0) scale(1); opacity:0; }
            10% { opacity:1; }
            90% { opacity:1; }
            100% { transform: translateY(-100vh) translateX(50px) scale(0.3); opacity:0; }
        }

        /* ═══ LAYOUT ═══ */
        .container { max-width:1000px; margin:0 auto; padding:1.5rem; position:relative; z-index:1; }

        /* ═══ HEADER ═══ */
        .header { text-align:center; padding:2.5rem 0 1.5rem; }
        .logo-wrapper { position:relative; display:inline-block; margin-bottom:1rem; }
        .logo-glow {
            position:absolute; inset:-20px; border-radius:50%;
            background: radial-gradient(circle, var(--glow-red), transparent 70%);
            animation: pulseGlow 3s ease-in-out infinite;
            filter: blur(20px);
        }
        @keyframes pulseGlow { 0%,100%{opacity:.4;transform:scale(1)} 50%{opacity:.7;transform:scale(1.1)} }
        .logo-text {
            position:relative; font-size:3rem; font-weight:900; letter-spacing:4px;
            background: linear-gradient(135deg, #e63946 0%, #d4a843 50%, #e63946 100%);
            background-size: 200% 200%;
            -webkit-background-clip:text; -webkit-text-fill-color:transparent;
            animation: shimmer 3s linear infinite;
        }
        @keyframes shimmer { 0%{background-position:0% 50%} 100%{background-position:200% 50%} }
        .subtitle { color:var(--text-dim); font-size:.95rem; margin-bottom:1rem; }
        .badge-row { display:flex; gap:.5rem; justify-content:center; flex-wrap:wrap; }
        .badge {
            padding:5px 14px; border-radius:20px; font-size:.72rem; font-weight:600;
            background:rgba(255,255,255,0.04); border:1px solid var(--border); color:var(--text-dim);
        }
        .badge.live {
            border-color:var(--green); color:var(--green);
            box-shadow: 0 0 12px rgba(34,197,94,0.2);
            animation: badgePulse 2s infinite;
        }
        @keyframes badgePulse { 0%,100%{box-shadow:0 0 8px rgba(34,197,94,0.15)} 50%{box-shadow:0 0 18px rgba(34,197,94,0.35)} }

        /* ═══ GLASS CARDS ═══ */
        .card {
            background: var(--bg-card); border:1px solid var(--border);
            border-radius:20px; padding:2rem; margin-bottom:1.5rem;
            backdrop-filter: blur(12px);
            transition: border-color .3s, box-shadow .3s;
        }
        .card:hover { border-color: rgba(255,255,255,0.12); box-shadow: 0 8px 32px rgba(0,0,0,0.2); }
        .card h2 {
            font-size:1.1rem; font-weight:700; margin-bottom:1.2rem;
            display:flex; align-items:center; gap:.5rem;
        }
        .card h2 .step-num {
            width:28px; height:28px; border-radius:8px; display:flex; align-items:center; justify-content:center;
            font-size:.75rem; font-weight:800;
            background: linear-gradient(135deg, var(--red), var(--gold));
            color: #fff;
        }

        /* ═══ TYPE SELECTOR ═══ */
        .type-grid { display:grid; grid-template-columns:repeat(5,1fr); gap:.5rem; margin-bottom:1rem; }
        .type-btn {
            padding:14px 6px; border:1px solid var(--border); border-radius:14px;
            background:var(--bg-card); color:var(--text-dim); text-align:center;
            cursor:pointer; transition:all .25s; font-size:.72rem; font-weight:500;
            position:relative; overflow:hidden;
        }
        .type-btn::before {
            content:''; position:absolute; inset:0; opacity:0;
            background: radial-gradient(circle at center, var(--glow-red), transparent 70%);
            transition: opacity .3s;
        }
        .type-btn:hover::before { opacity:.5; }
        .type-btn:hover { border-color:var(--gold); color:#fff; transform:translateY(-2px); }
        .type-btn.selected {
            border-color:var(--red); color:#fff;
            background: linear-gradient(135deg, rgba(230,57,70,0.12), rgba(212,168,67,0.08));
            box-shadow: 0 0 20px var(--glow-red);
        }
        .type-btn.selected::before { opacity:.6; }
        .type-icon { font-size:1.6rem; display:block; margin-bottom:4px; position:relative; }

        /* ═══ FORM ═══ */
        .form-grid { display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
        .form-group { display:flex; flex-direction:column; gap:.3rem; }
        .form-group.full { grid-column:1/-1; }
        .form-group.hidden { display:none; }
        label { font-size:.75rem; color:var(--text-dim); font-weight:600; text-transform:uppercase; letter-spacing:.5px; }
        input, select, textarea {
            padding:11px 14px; border:1px solid var(--border); border-radius:12px;
            background:rgba(255,255,255,0.04); color:#fff; font-size:.9rem;
            font-family:'Inter',sans-serif; outline:none; transition: all .25s;
        }
        input:focus, select:focus, textarea:focus {
            border-color:var(--gold);
            box-shadow: 0 0 16px var(--glow-gold);
        }
        select { cursor:pointer; }
        select option { background:#0f172a; }
        textarea { resize:vertical; min-height:80px; }

        /* ═══ UPLOAD ═══ */
        .upload-zone {
            border:2px dashed rgba(255,255,255,0.1); border-radius:16px; padding:2rem;
            text-align:center; cursor:pointer; transition:all .3s; position:relative;
            background: rgba(255,255,255,0.02);
        }
        .upload-zone:hover { border-color:var(--cyan); background:rgba(6,182,212,0.04); box-shadow:0 0 30px var(--glow-cyan); }
        .upload-zone input[type="file"] { position:absolute; inset:0; opacity:0; cursor:pointer; }
        .upload-icon { font-size:2.5rem; margin-bottom:.5rem; filter:drop-shadow(0 0 8px var(--glow-cyan)); }
        .upload-text { color:var(--text-dim); font-size:.8rem; }
        .file-name { color:var(--green); font-size:.85rem; margin-top:.5rem; font-weight:600; }
        .or-divider {
            text-align:center; margin:1.5rem 0; color:rgba(255,255,255,0.2); font-size:.8rem;
            display:flex; align-items:center; gap:1rem;
        }
        .or-divider::before,.or-divider::after { content:''; flex:1; height:1px; background:var(--border); }

        /* ═══ ANALYZE BUTTON ═══ */
        .btn-analyze {
            width:100%; padding:16px; border:none; border-radius:14px; cursor:pointer;
            font-size:1.1rem; font-weight:800; font-family:'Inter',sans-serif;
            color:#fff; position:relative; overflow:hidden; transition:all .3s;
            background: linear-gradient(135deg, #e63946 0%, #c62828 50%, #e63946 100%);
            background-size: 200% 200%;
            animation: btnGradient 3s ease infinite;
        }
        @keyframes btnGradient { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
        .btn-analyze::before {
            content:''; position:absolute; top:-50%; left:-50%; width:200%; height:200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1), transparent 60%);
            transform: rotate(45deg); transition: all .5s;
        }
        .btn-analyze:hover { transform:translateY(-3px); box-shadow: 0 12px 40px var(--glow-red); }
        .btn-analyze:hover::before { left:100%; }
        .btn-analyze:disabled { opacity:.4; cursor:not-allowed; transform:none; animation:none; }

        /* ═══════════════════════════════════════ */
        /* ═══ AGENT PIPELINE VISUALIZATION ═══ */
        /* ═══════════════════════════════════════ */
        .pipeline-section { display:none; }

        .pipeline-header {
            text-align:center; margin-bottom:2rem;
        }
        .pipeline-header h2 {
            font-size:1.5rem; font-weight:900; justify-content:center;
            background: linear-gradient(135deg, var(--red), var(--gold));
            -webkit-background-clip:text; -webkit-text-fill-color:transparent;
        }
        .pipeline-timer {
            font-size:.85rem; color:var(--text-dim); margin-top:.5rem;
            font-variant-numeric: tabular-nums;
        }

        /* Phase container */
        .phase-block {
            margin-bottom:1.5rem; border-radius:16px; overflow:hidden;
            border:1px solid var(--border); background:var(--bg-card);
            transition: border-color .5s, box-shadow .5s;
        }
        .phase-block.active { border-color: var(--gold); box-shadow: 0 0 30px var(--glow-gold); }
        .phase-block.done { border-color: var(--green); box-shadow: 0 0 20px var(--glow-green); }
        .phase-label {
            padding:12px 20px; font-size:.8rem; font-weight:700; text-transform:uppercase; letter-spacing:1.5px;
            display:flex; align-items:center; gap:.7rem;
            background: rgba(255,255,255,0.02);
        }
        .phase-indicator {
            width:10px; height:10px; border-radius:50%; background:rgba(255,255,255,0.1);
            transition: all .5s;
        }
        .phase-block.active .phase-indicator { background:var(--gold); box-shadow:0 0 12px var(--glow-gold); animation:pulse 1.2s infinite; }
        .phase-block.done .phase-indicator { background:var(--green); box-shadow:0 0 10px var(--glow-green); }
        @keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.4;transform:scale(.7)} }

        .phase-progress {
            height:3px; background:rgba(255,255,255,0.05);
        }
        .phase-progress-bar {
            height:100%; width:0%; transition: width .5s;
            background: linear-gradient(90deg, var(--gold), var(--green));
        }
        .phase-block.done .phase-progress-bar { width:100%; background:var(--green); }

        /* Agent nodes grid */
        .agents-grid {
            display:grid; grid-template-columns:repeat(auto-fill, minmax(130px, 1fr));
            gap:8px; padding:14px;
        }
        .agent-node {
            padding:10px 8px; border-radius:12px; text-align:center;
            border:1px solid transparent; background:rgba(255,255,255,0.02);
            transition: all .4s; position:relative; overflow:hidden;
        }
        .agent-node::before {
            content:''; position:absolute; inset:0; opacity:0; transition:opacity .4s;
            background: radial-gradient(circle at 50% 50%, var(--glow-purple), transparent 70%);
        }
        .agent-node.waiting { opacity:.4; }
        .agent-node.running {
            border-color:var(--cyan); background:rgba(6,182,212,0.06);
            animation: nodeGlow 1.5s ease-in-out infinite;
        }
        .agent-node.running::before { opacity:.8; background: radial-gradient(circle, var(--glow-cyan), transparent 70%); }
        @keyframes nodeGlow { 0%,100%{box-shadow:0 0 8px var(--glow-cyan)} 50%{box-shadow:0 0 25px var(--glow-cyan)} }
        .agent-node.done { border-color:rgba(34,197,94,0.3); background:rgba(34,197,94,0.05); }
        .agent-node.error { border-color:rgba(239,68,68,0.3); background:rgba(239,68,68,0.05); }

        .agent-icon { font-size:1.4rem; display:block; margin-bottom:3px; position:relative; }
        .agent-name { font-size:.65rem; font-weight:700; color:var(--text-dim); text-transform:uppercase; letter-spacing:.5px; }
        .agent-model { font-size:.55rem; color:rgba(255,255,255,0.2); margin-top:2px; }
        .agent-status {
            font-size:.55rem; font-weight:600; margin-top:3px;
            display:flex; align-items:center; justify-content:center; gap:3px;
        }
        .agent-node.running .agent-status { color:var(--cyan); }
        .agent-node.done .agent-status { color:var(--green); }
        .agent-node.error .agent-status { color:#ef4444; }

        .spinner-dot {
            width:4px; height:4px; border-radius:50%; background:var(--cyan);
            animation: spinDot .8s ease-in-out infinite;
        }
        @keyframes spinDot { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.3;transform:scale(.5)} }
        .check-mark { color:var(--green); font-weight:800; }

        /* Data flow lines */
        .flow-connector {
            display:flex; align-items:center; justify-content:center;
            padding:6px 0; position:relative;
        }
        .flow-line {
            width:2px; height:24px; position:relative; overflow:hidden;
            background: rgba(255,255,255,0.06);
        }
        .flow-line.active::after {
            content:''; position:absolute; top:-100%; left:0; width:100%; height:50%;
            background: linear-gradient(180deg, transparent, var(--cyan), transparent);
            animation: flowDown 1s linear infinite;
        }
        @keyframes flowDown { 0%{top:-50%} 100%{top:150%} }
        .flow-dots {
            display:flex; gap:3px; position:absolute;
        }
        .flow-dots span {
            width:4px; height:4px; border-radius:50%; background:var(--cyan); opacity:0;
        }
        .flow-line.active .flow-dots span { animation: dotStream .6s ease-in-out infinite; }
        .flow-dots span:nth-child(2) { animation-delay:.2s; }
        .flow-dots span:nth-child(3) { animation-delay:.4s; }
        @keyframes dotStream { 0%{opacity:0;transform:translateY(-8px)} 50%{opacity:1} 100%{opacity:0;transform:translateY(8px)} }

        /* Central brain visualization */
        .brain-core {
            width:100px; height:100px; margin:0 auto 1rem; position:relative;
            display:flex; align-items:center; justify-content:center;
        }
        .brain-ring {
            position:absolute; inset:0; border-radius:50%; border:2px solid transparent;
            border-top-color:var(--red); border-right-color:var(--gold);
            animation: spinRing 2s linear infinite;
        }
        .brain-ring.inner {
            inset:12px; border-top-color:var(--cyan); border-right-color:var(--purple);
            animation-direction:reverse; animation-duration:1.5s;
        }
        .brain-ring.outer {
            inset:-8px; border-top-color:var(--gold); border-right-color:var(--green);
            animation-duration:3s; opacity:.4;
        }
        @keyframes spinRing { 0%{transform:rotate(0)} 100%{transform:rotate(360deg)} }
        .brain-icon { font-size:2.2rem; position:relative; z-index:1; filter:drop-shadow(0 0 12px var(--glow-purple)); }
        .brain-text { text-align:center; font-size:.75rem; color:var(--text-dim); }

        /* ═══ RESULTS ═══ */
        .results-section { display:none; }

        .score-display {
            text-align:center; padding:2rem 0;
        }
        .score-ring {
            width:160px; height:160px; margin:0 auto 1rem; position:relative;
        }
        .score-ring svg { width:100%; height:100%; transform:rotate(-90deg); }
        .score-ring-bg { fill:none; stroke:rgba(255,255,255,0.06); stroke-width:8; }
        .score-ring-fill {
            fill:none; stroke-width:8; stroke-linecap:round;
            stroke-dasharray:440; stroke-dashoffset:440;
            transition: stroke-dashoffset 2s ease-out, stroke 1s;
        }
        .score-center {
            position:absolute; inset:0; display:flex; flex-direction:column;
            align-items:center; justify-content:center;
        }
        .score-num { font-size:2.8rem; font-weight:900; line-height:1; }
        .score-label { font-size:.7rem; color:var(--text-dim); margin-top:2px; }

        .reco-box {
            margin:1rem auto; padding:14px 28px; border-radius:14px; text-align:center;
            font-weight:800; font-size:1.15rem; display:inline-block;
            animation: fadeInUp .6s ease;
        }
        .reco-contester { background:rgba(34,197,94,0.12); color:var(--green); border:1px solid rgba(34,197,94,0.2); box-shadow:0 0 30px var(--glow-green); }
        .reco-negocier { background:rgba(245,158,11,0.12); color:#f59e0b; border:1px solid rgba(245,158,11,0.2); box-shadow:0 0 30px rgba(245,158,11,0.2); }
        .reco-payer { background:rgba(239,68,68,0.12); color:#ef4444; border:1px solid rgba(239,68,68,0.2); box-shadow:0 0 30px rgba(239,68,68,0.2); }

        @keyframes fadeInUp { 0%{opacity:0;transform:translateY(20px)} 100%{opacity:1;transform:translateY(0)} }
        .fade-in { animation: fadeInUp .5s ease forwards; }

        .result-row {
            display:flex; justify-content:space-between; padding:.7rem 0;
            border-bottom:1px solid var(--border); font-size:.88rem;
        }
        .result-label { color:var(--text-dim); }
        .result-value { font-weight:700; }

        .args-list { list-style:none; }
        .args-list li {
            padding:.6rem .8rem; margin-bottom:.4rem; border-radius:10px;
            background:rgba(255,255,255,0.03); border-left:3px solid var(--gold);
            font-size:.85rem; color:#ccd; line-height:1.5;
            animation: fadeInUp .4s ease forwards;
            opacity:0;
        }
        .etapes-list { list-style:none; counter-reset:etape; }
        .etapes-list li {
            padding:.6rem .8rem .6rem 2.5rem; margin-bottom:.4rem; border-radius:10px;
            background:rgba(255,255,255,0.03); font-size:.85rem; color:#ccd; line-height:1.5;
            position:relative; animation: fadeInUp .4s ease forwards; opacity:0;
        }
        .etapes-list li::before {
            counter-increment:etape; content:counter(etape);
            position:absolute; left:8px; top:8px; width:22px; height:22px; border-radius:6px;
            background: linear-gradient(135deg, var(--navy), var(--purple));
            color:#fff; font-size:.7rem; font-weight:800;
            display:flex; align-items:center; justify-content:center;
        }

        .precedent-chip {
            display:inline-block; padding:6px 12px; margin:3px; border-radius:8px;
            background:rgba(255,255,255,0.04); border:1px solid var(--border);
            font-size:.72rem; color:var(--text-dim);
        }
        .precedent-chip .cit { color:var(--gold); font-weight:600; }

        .models-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); gap:6px; }
        .model-chip {
            padding:8px 10px; border-radius:10px; font-size:.65rem;
            background:rgba(255,255,255,0.03); border:1px solid var(--border);
            text-align:center; line-height:1.4;
        }
        .model-chip .mn { color:var(--cyan); font-weight:700; font-size:.7rem; }

        .btn-secondary {
            width:100%; padding:14px; border:1px solid var(--border); border-radius:14px;
            background:rgba(255,255,255,0.04); color:var(--text); font-size:1rem;
            font-weight:700; cursor:pointer; transition:all .3s; font-family:'Inter',sans-serif;
        }
        .btn-secondary:hover { border-color:var(--gold); background:rgba(212,168,67,0.08); }

        .btn-pdf {
            display:inline-block; padding:12px 28px; border-radius:12px; text-decoration:none;
            background: linear-gradient(135deg, var(--red), #c62828); color:#fff;
            font-weight:700; font-size:.9rem; transition:all .3s; margin-top:.5rem;
        }
        .btn-pdf:hover { transform:translateY(-2px); box-shadow:0 8px 25px var(--glow-red); }

        .desc-note { font-size:.7rem; color:rgba(255,255,255,0.25); margin-top:.5rem; font-style:italic; }

        @media (max-width:700px) {
            .type-grid { grid-template-columns:repeat(3,1fr); }
            .form-grid { grid-template-columns:1fr; }
            .agents-grid { grid-template-columns:repeat(3,1fr); }
            .logo-text { font-size:2.2rem; }
        }
        @media (max-width:400px) {
            .type-grid { grid-template-columns:repeat(2,1fr); }
            .agents-grid { grid-template-columns:repeat(2,1fr); }
        }
    </style>
</head>
<body>

<div id="particles-bg"></div>

<div class="container">
    <!-- ═══ HEADER ═══ -->
    <div class="header">
        <div class="logo-wrapper">
            <div class="logo-glow"></div>
            <div class="logo-text">TICKET911</div>
        </div>
        <p class="subtitle">Intelligence artificielle multi-agents | Droit routier QC &amp; ON</p>
        <div class="badge-row">
            <span class="badge live" id="statusBadge">Connexion...</span>
            <span class="badge">26 agents</span>
            <span class="badge">12 moteurs AI</span>
            <span class="badge">4 phases</span>
        </div>
    </div>

    <!-- ═══ FORM CARD ═══ -->
    <div class="card" id="formCard">
        <h2><span class="step-num">1</span> Type de contravention</h2>
        <div class="type-grid" id="typeGrid">
            <div class="type-btn" data-type="vitesse" onclick="selectType(this)"><span class="type-icon">&#9889;</span>Vitesse</div>
            <div class="type-btn" data-type="feu_rouge" onclick="selectType(this)"><span class="type-icon">&#128308;</span>Feu rouge</div>
            <div class="type-btn" data-type="stop" onclick="selectType(this)"><span class="type-icon">&#9940;</span>Stop</div>
            <div class="type-btn" data-type="cellulaire" onclick="selectType(this)"><span class="type-icon">&#128241;</span>Cellulaire</div>
            <div class="type-btn" data-type="ceinture" onclick="selectType(this)"><span class="type-icon">&#128737;&#65039;</span>Ceinture</div>
            <div class="type-btn" data-type="alcool" onclick="selectType(this)"><span class="type-icon">&#127866;</span>Alcool</div>
            <div class="type-btn" data-type="conduite_dangereuse" onclick="selectType(this)"><span class="type-icon">&#9888;&#65039;</span>Dangereuse</div>
            <div class="type-btn" data-type="stationnement" onclick="selectType(this)"><span class="type-icon">&#127359;&#65039;</span>Parking</div>
            <div class="type-btn" data-type="permis" onclick="selectType(this)"><span class="type-icon">&#128179;</span>Permis</div>
            <div class="type-btn" data-type="autre" onclick="selectType(this)"><span class="type-icon">&#128221;</span>Autre</div>
        </div>

        <div class="or-divider">OU PHOTO DU TICKET</div>

        <div class="form-group full" style="margin-bottom:1.5rem">
            <div class="upload-zone" id="uploadZone">
                <input type="file" id="ticketPhoto" accept="image/*" onchange="showFileName(this)">
                <div class="upload-icon">&#128247;</div>
                <div class="upload-text">Glisser ou cliquer — Vision AI extraira les informations</div>
                <div class="file-name" id="fileName"></div>
            </div>
        </div>

        <form id="ticketForm" onsubmit="return submitAnalysis(event)">
            <h2><span class="step-num">2</span> Details</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Juridiction</label>
                    <select id="juridiction"><option value="QC">Quebec</option><option value="ON">Ontario</option></select>
                </div>
                <div class="form-group">
                    <label>Infraction</label>
                    <input type="text" id="infraction" placeholder="Ex: Exces de vitesse" required>
                </div>
                <div class="form-group">
                    <label>Article de loi</label>
                    <input type="text" id="loi" placeholder="Ex: Art. 299 CSR">
                </div>
                <div class="form-group">
                    <label>Amende ($)</label>
                    <input type="text" id="amende" placeholder="Ex: 368$">
                </div>
                <div class="form-group">
                    <label>Points</label>
                    <input type="number" id="points" value="0" min="0" max="15">
                </div>
                <div class="form-group">
                    <label>Lieu</label>
                    <input type="text" id="lieu" placeholder="Ex: Boul. Rene-Levesque">
                </div>
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="date">
                </div>
                <div class="form-group hidden" id="grp_appareil">
                    <label>Appareil de mesure</label>
                    <select id="appareil">
                        <option value="">Inconnu</option>
                        <option value="Cinematometre laser">Cinematometre laser</option>
                        <option value="Radar photo">Radar photo</option>
                        <option value="Radar mobile">Radar mobile</option>
                        <option value="Camera feu rouge">Camera feu rouge</option>
                        <option value="Estimation visuelle">Estimation visuelle</option>
                    </select>
                </div>
                <div class="form-group hidden" id="grp_captee"><label>Vitesse captee (km/h)</label><input type="number" id="vitesse_captee" value="0" min="0"></div>
                <div class="form-group hidden" id="grp_permise"><label>Vitesse permise (km/h)</label><input type="number" id="vitesse_permise" value="0" min="0"></div>
                <div class="form-group hidden" id="grp_taux"><label>Taux alcoolemie</label><input type="number" id="taux_alcool" value="0" min="0" max="500"></div>
                <div class="form-group hidden" id="grp_test"><label>Type de test</label><select id="test_alcool"><option value="">—</option><option value="Alcootest approuve">Alcootest</option><option value="Ethylometre">Ethylometre</option><option value="Refus">Refus</option></select></div>
                <div class="form-group full"><label>Description / Contexte</label><textarea id="description" placeholder="Decrivez ce qui s'est passe..."></textarea></div>
                <div class="form-group full"><label>Email (rapport)</label><input type="email" id="email" placeholder="votre@email.com"></div>
            </div>
            <br>
            <button type="submit" class="btn-analyze" id="btnAnalyze">&#9889; Lancer l'analyse — 26 agents AI</button>
            <div style="text-align:center;margin-top:1rem">
                <button type="button" class="btn-secondary" onclick="runDemo()" style="width:auto;padding:10px 28px;border-color:var(--cyan);color:var(--cyan);font-size:.85rem;">
                    &#127916; Demo — Tester sans ticket
                </button>
                <p class="desc-note">Simule une analyse complete avec des donnees fictives</p>
            </div>
        </form>
    </div>

    <!-- ═══ PIPELINE VISUALIZATION ═══ -->
    <div class="pipeline-section" id="pipelineSection">
        <div class="pipeline-header">
            <div class="brain-core">
                <div class="brain-ring outer"></div>
                <div class="brain-ring"></div>
                <div class="brain-ring inner"></div>
                <span class="brain-icon">&#129504;</span>
            </div>
            <h2>Analyse multi-agents en cours</h2>
            <div class="pipeline-timer"><span id="timerCount">0</span>s | <span id="agentCount">0</span>/26 agents</div>
        </div>

        <!-- Phase 1: INTAKE -->
        <div class="phase-block" id="pb1">
            <div class="phase-label"><div class="phase-indicator"></div>PHASE 1 — INTAKE</div>
            <div class="phase-progress"><div class="phase-progress-bar" id="pp1"></div></div>
            <div class="agents-grid">
                <div class="agent-node waiting" id="ag-lecteur"><span class="agent-icon">&#128196;</span><span class="agent-name">Lecteur</span><span class="agent-model">GPT-OSS 20B</span><span class="agent-status"></span></div>
                <div class="agent-node waiting" id="ag-ocr"><span class="agent-icon">&#128247;</span><span class="agent-name">OCR</span><span class="agent-model">Qwen3-VL</span><span class="agent-status"></span></div>
                <div class="agent-node waiting" id="ag-classificateur"><span class="agent-icon">&#127991;</span><span class="agent-name">Classificateur</span><span class="agent-model">Qwen3 235B</span><span class="agent-status"></span></div>
                <div class="agent-node waiting" id="ag-validateur"><span class="agent-icon">&#9989;</span><span class="agent-name">Validateur</span><span class="agent-model">DeepSeek V3</span><span class="agent-status"></span></div>
                <div class="agent-node waiting" id="ag-routing"><span class="agent-icon">&#128268;</span><span class="agent-name">Routing</span><span class="agent-model">GPT-OSS 20B</span><span class="agent-status"></span></div>
            </div>
        </div>

        <div class="flow-connector"><div class="flow-line" id="flow1"></div></div>

        <!-- Phase 2: ANALYSE -->
        <div class="phase-block" id="pb2">
            <div class="phase-label"><div class="phase-indicator"></div>PHASE 2 — ANALYSE JURIDIQUE</div>
            <div class="phase-progress"><div class="phase-progress-bar" id="pp2"></div></div>
            <div class="agents-grid">
                <div class="agent-node waiting" id="ag-lois"><span class="agent-icon">&#128220;</span><span class="agent-name">Lois</span><span class="agent-model">Qwen3 235B</span><span class="agent-status"></span></div>
                <div class="agent-node waiting" id="ag-lois-qc"><span class="agent-icon">&#9878;</span><span class="agent-name">Lois QC</span><span class="agent-model">Mixtral FR</span><span class="agent-status"></span></div>
                <div class="agent-node waiting" id="ag-lois-on"><span class="agent-icon">&#127809;</span><span class="agent-name">Lois ON</span><span class="agent-model">GLM-4</span><span class="agent-status"></span></div>
                <div class="agent-node waiting" id="ag-precedents"><span class="agent-icon">&#128218;</span><span class="agent-name">Precedents</span><span class="agent-model">FTS + ChromaDB</span><span class="agent-status"></span></div>
                <div class="agent-node waiting" id="ag-precedents-qc"><span class="agent-icon">&#9878;</span><span class="agent-name">Preced. QC</span><span class="agent-model">Semantic</span><span class="agent-status"></span></div>
                <div class="agent-node waiting" id="ag-precedents-on"><span class="agent-icon">&#127809;</span><span class="agent-name">Preced. ON</span><span class="agent-model">Semantic</span><span class="agent-status"></span></div>
                <div class="agent-node waiting" id="ag-analyste"><span class="agent-icon">&#129504;</span><span class="agent-name">Analyste</span><span class="agent-model">DeepSeek V3</span><span class="agent-status"></span></div>
                <div class="agent-node waiting" id="ag-analyste-qc"><span class="agent-icon">&#9878;</span><span class="agent-name">Analyste QC</span><span class="agent-model">Cogito 671B</span><span class="agent-status"></span></div>
                <div class="agent-node waiting" id="ag-analyste-on"><span class="agent-icon">&#127809;</span><span class="agent-name">Analyste ON</span><span class="agent-model">Kimi K2</span><span class="agent-status"></span></div>
                <div class="agent-node waiting" id="ag-procedure"><span class="agent-icon">&#128203;</span><span class="agent-name">Procedure</span><span class="agent-model">DeepSeek V3</span><span class="agent-status"></span></div>
                <div class="agent-node waiting" id="ag-procedure-qc"><span class="agent-icon">&#9878;</span><span class="agent-name">Proc. QC</span><span class="agent-model">Mixtral FR</span><span class="agent-status"></span></div>
                <div class="agent-node waiting" id="ag-procedure-on"><span class="agent-icon">&#127809;</span><span class="agent-name">Proc. ON</span><span class="agent-model">GLM-4</span><span class="agent-status"></span></div>
                <div class="agent-node waiting" id="ag-points"><span class="agent-icon">&#128200;</span><span class="agent-name">Points</span><span class="agent-model">GPT-OSS 120B</span><span class="agent-status"></span></div>
                <div class="agent-node waiting" id="ag-temoignage"><span class="agent-icon">&#128483;</span><span class="agent-name">Temoignage</span><span class="agent-model">Cogito 671B</span><span class="agent-status"></span></div>
                <div class="agent-node waiting" id="ag-photo"><span class="agent-icon">&#128248;</span><span class="agent-name">Photo Anal.</span><span class="agent-model">Qwen3-VL</span><span class="agent-status"></span></div>
            </div>
        </div>

        <div class="flow-connector"><div class="flow-line" id="flow2"></div></div>

        <!-- Phase 3: AUDIT -->
        <div class="phase-block" id="pb3">
            <div class="phase-label"><div class="phase-indicator"></div>PHASE 3 — AUDIT &amp; VERIFICATION</div>
            <div class="phase-progress"><div class="phase-progress-bar" id="pp3"></div></div>
            <div class="agents-grid">
                <div class="agent-node waiting" id="ag-verificateur"><span class="agent-icon">&#128270;</span><span class="agent-name">Verificateur</span><span class="agent-model">DeepSeek R1</span><span class="agent-status"></span></div>
                <div class="agent-node waiting" id="ag-cross"><span class="agent-icon">&#128256;</span><span class="agent-name">Cross-Verif</span><span class="agent-model">Kimi Think</span><span class="agent-status"></span></div>
            </div>
        </div>

        <div class="flow-connector"><div class="flow-line" id="flow3"></div></div>

        <!-- Phase 4: LIVRAISON -->
        <div class="phase-block" id="pb4">
            <div class="phase-label"><div class="phase-indicator"></div>PHASE 4 — LIVRAISON</div>
            <div class="phase-progress"><div class="phase-progress-bar" id="pp4"></div></div>
            <div class="agents-grid">
                <div class="agent-node waiting" id="ag-rapport-client"><span class="agent-icon">&#128209;</span><span class="agent-name">Rapport Client</span><span class="agent-model">Mixtral FR</span><span class="agent-status"></span></div>
                <div class="agent-node waiting" id="ag-rapport-avocat"><span class="agent-icon">&#9878;</span><span class="agent-name">Rapport Avocat</span><span class="agent-model">DeepSeek V3</span><span class="agent-status"></span></div>
                <div class="agent-node waiting" id="ag-notification"><span class="agent-icon">&#128231;</span><span class="agent-name">Notification</span><span class="agent-model">SMTP</span><span class="agent-status"></span></div>
                <div class="agent-node waiting" id="ag-superviseur"><span class="agent-icon">&#128081;</span><span class="agent-name">Superviseur</span><span class="agent-model">MiniMax</span><span class="agent-status"></span></div>
            </div>
        </div>
    </div>

    <!-- ═══ RESULTS ═══ -->
    <div class="results-section" id="resultsSection">
        <div class="card fade-in" style="text-align:center">
            <h2 style="justify-content:center">Resultat de l'analyse</h2>
            <div class="score-display">
                <div class="score-ring">
                    <svg viewBox="0 0 160 160">
                        <circle class="score-ring-bg" cx="80" cy="80" r="70"/>
                        <circle class="score-ring-fill" id="scoreRingFill" cx="80" cy="80" r="70"/>
                    </svg>
                    <div class="score-center">
                        <span class="score-num" id="scoreNum">0%</span>
                        <span class="score-label">chances de contestation</span>
                    </div>
                </div>
            </div>
            <div class="reco-box" id="recoBox"></div>
        </div>

        <div class="card fade-in" id="detailsCard">
            <h2>&#128203; Details du dossier</h2>
            <div id="resultDetails"></div>
        </div>

        <div class="card fade-in">
            <h2>&#128161; Arguments de defense</h2>
            <ul class="args-list" id="argsList"></ul>
        </div>

        <div class="card fade-in">
            <h2>&#9989; Prochaines etapes</h2>
            <ol class="etapes-list" id="etapesList"></ol>
        </div>

        <div class="card fade-in" id="precedentsCard" style="display:none">
            <h2>&#128218; Precedents cites</h2>
            <div id="precedentsList"></div>
        </div>

        <div class="card fade-in" style="text-align:center">
            <h2 style="justify-content:center">&#128196; Rapport</h2>
            <p id="rapportResume" style="font-size:.88rem;color:#aab;line-height:1.7;text-align:left;margin-bottom:1rem"></p>
            <a class="btn-pdf" id="pdfLink" href="#" target="_blank">Telecharger le rapport PDF</a>
        </div>

        <div class="card fade-in">
            <h2>&#129302; Moteurs AI utilises</h2>
            <div class="models-grid">
                <div class="model-chip"><span class="mn">DeepSeek V3p2</span><br>Analyse gen.</div>
                <div class="model-chip"><span class="mn">Qwen3 235B</span><br>Classification</div>
                <div class="model-chip"><span class="mn">DeepSeek R1</span><br>Verification</div>
                <div class="model-chip"><span class="mn">Cogito 671B</span><br>Temoignage</div>
                <div class="model-chip"><span class="mn">Mixtral 8x22B</span><br>Rapports FR</div>
                <div class="model-chip"><span class="mn">GLM-4p7</span><br>Ontario EN</div>
                <div class="model-chip"><span class="mn">Kimi K2</span><br>Agentic</div>
                <div class="model-chip"><span class="mn">Kimi Think</span><br>Audit</div>
                <div class="model-chip"><span class="mn">Qwen3-VL</span><br>Vision OCR</div>
                <div class="model-chip"><span class="mn">GPT-OSS 20B</span><br>Rapide</div>
                <div class="model-chip"><span class="mn">GPT-OSS 120B</span><br>Points calc.</div>
                <div class="model-chip"><span class="mn">MiniMax M2</span><br>Supervision</div>
            </div>
        </div>

        <button class="btn-secondary" onclick="resetForm()">&#8634; Nouvelle analyse</button>
    </div>
</div>

<script>
const API_BASE = window.location.pathname.includes('/scanticket') ? '/scanticket/api' : '/api';
let selectedType = '';

// ═══ PARTICLES ═══
(function initParticles(){
    const bg = document.getElementById('particles-bg');
    for(let i=0;i<30;i++){
        const p = document.createElement('div');
        p.className = 'particle';
        const size = Math.random()*3+1;
        const colors = ['var(--red)','var(--gold)','var(--cyan)','var(--purple)','var(--green)'];
        p.style.cssText = `width:${size}px;height:${size}px;left:${Math.random()*100}%;top:${Math.random()*100+100}%;background:${colors[i%colors.length]};opacity:0.4;animation-duration:${Math.random()*15+10}s;animation-delay:${Math.random()*10}s;`;
        bg.appendChild(p);
    }
})();

// ═══ HEALTH CHECK ═══
fetch(API_BASE+'/health').then(r=>r.json()).then(d=>{
    const b=document.getElementById('statusBadge');
    if(d.status==='ok'){b.textContent=d.agents+' agents en ligne';b.classList.add('live');}
    else{b.textContent='Hors ligne';b.classList.remove('live');}
}).catch(()=>{
    document.getElementById('statusBadge').textContent='Hors ligne';
    document.getElementById('statusBadge').classList.remove('live');
});

// ═══ TYPE SELECTION ═══
function selectType(el){
    document.querySelectorAll('.type-btn').forEach(b=>b.classList.remove('selected'));
    el.classList.add('selected'); selectedType=el.dataset.type;
    const names={vitesse:'Exces de vitesse',feu_rouge:'Feu rouge',stop:'Arret stop',cellulaire:'Cellulaire au volant',ceinture:'Ceinture de securite',alcool:'Capacites affaiblies',conduite_dangereuse:'Conduite dangereuse',stationnement:'Stationnement',permis:'Permis/Immatriculation',autre:''};
    document.getElementById('infraction').value=names[selectedType]||'';
    ['grp_captee','grp_permise'].forEach(id=>document.getElementById(id).classList.toggle('hidden',selectedType!=='vitesse'));
    ['grp_taux','grp_test'].forEach(id=>document.getElementById(id).classList.toggle('hidden',selectedType!=='alcool'));
    document.getElementById('grp_appareil').classList.toggle('hidden',!['vitesse','feu_rouge'].includes(selectedType));
}
function showFileName(input){document.getElementById('fileName').textContent=input.files[0]?input.files[0].name:'';}

// ═══ PIPELINE AGENT ANIMATION ═══
const PIPELINE = {
    1: {agents:['ag-lecteur','ag-ocr','ag-classificateur','ag-validateur','ag-routing'], duration:8},
    2: {agents:['ag-lois','ag-lois-qc','ag-lois-on','ag-precedents','ag-precedents-qc','ag-precedents-on','ag-analyste','ag-analyste-qc','ag-analyste-on','ag-procedure','ag-procedure-qc','ag-procedure-on','ag-points','ag-temoignage','ag-photo'], duration:30},
    3: {agents:['ag-verificateur','ag-cross'], duration:10},
    4: {agents:['ag-rapport-client','ag-rapport-avocat','ag-notification','ag-superviseur'], duration:12},
};

let timerInterval, agentsDone=0;

function runPipelineAnimation(){
    agentsDone=0; let elapsed=0; const startTime=Date.now();
    // Timer
    timerInterval = setInterval(()=>{
        const s=Math.round((Date.now()-startTime)/1000);
        document.getElementById('timerCount').textContent=s;
        document.getElementById('agentCount').textContent=agentsDone;
    },200);

    let delay=0;
    [1,2,3,4].forEach(phase=>{
        const p=PIPELINE[phase], block=document.getElementById('pb'+phase), bar=document.getElementById('pp'+phase);
        const flowId='flow'+(phase-1);

        // Activate phase
        setTimeout(()=>{
            block.classList.add('active');
            if(flowId!=='flow0') document.getElementById(flowId).classList.add('active');
        }, delay*1000);

        // Animate each agent
        const agentDelay = p.duration / (p.agents.length+1);
        p.agents.forEach((agId,i)=>{
            const startMs = (delay + agentDelay*(i+0.5))*1000;
            const endMs = startMs + agentDelay*1000*0.8;
            // Start running
            setTimeout(()=>{
                const node=document.getElementById(agId);
                node.classList.remove('waiting'); node.classList.add('running');
                node.querySelector('.agent-status').innerHTML='<span class="spinner-dot"></span><span class="spinner-dot" style="animation-delay:.2s"></span><span class="spinner-dot" style="animation-delay:.4s"></span>';
            }, startMs);
            // Done
            setTimeout(()=>{
                const node=document.getElementById(agId);
                node.classList.remove('running'); node.classList.add('done');
                node.querySelector('.agent-status').innerHTML='<span class="check-mark">&#10003;</span>';
                agentsDone++;
                // Update phase progress
                const doneInPhase = p.agents.filter(a=>document.getElementById(a).classList.contains('done')).length;
                bar.style.width = (doneInPhase/p.agents.length*100)+'%';
            }, endMs);
        });

        // Phase done
        setTimeout(()=>{
            block.classList.remove('active'); block.classList.add('done');
            bar.style.width='100%';
        }, (delay+p.duration)*1000);

        delay += p.duration;
    });
}

// ═══ SUBMIT ═══
async function submitAnalysis(e){
    e.preventDefault();
    const btn=document.getElementById('btnAnalyze');
    btn.disabled=true;

    document.getElementById('formCard').style.display='none';
    document.getElementById('pipelineSection').style.display='block';
    document.getElementById('resultsSection').style.display='none';
    runPipelineAnimation();

    const formData=new FormData();
    const ticket={
        infraction:document.getElementById('infraction').value,
        juridiction:document.getElementById('juridiction').value,
        loi:document.getElementById('loi').value,
        amende:document.getElementById('amende').value,
        points_inaptitude:parseInt(document.getElementById('points').value)||0,
        lieu:document.getElementById('lieu').value,
        date:document.getElementById('date').value,
        appareil:document.getElementById('appareil').value,
        vitesse_captee:parseInt(document.getElementById('vitesse_captee')?.value)||0,
        vitesse_permise:parseInt(document.getElementById('vitesse_permise')?.value)||0,
        type_infraction:selectedType,
    };
    if(selectedType==='alcool'){
        ticket.taux_alcool=parseInt(document.getElementById('taux_alcool').value)||0;
        ticket.test_alcool=document.getElementById('test_alcool').value;
    }
    const desc=document.getElementById('description').value;
    if(desc) formData.append('temoignage',desc);
    formData.append('ticket',JSON.stringify(ticket));
    formData.append('client_info',JSON.stringify({email:document.getElementById('email').value||''}));
    const photo=document.getElementById('ticketPhoto').files[0];
    if(photo) formData.append('image',photo);

    try{
        const resp=await fetch(API_BASE+'/analyze',{method:'POST',body:formData});
        const data=await resp.json();
        showResults(data);
    }catch(err){
        alert('Erreur: '+err.message); resetForm();
    }
}

// ═══ RESULTS ═══
function showResults(data){
    clearInterval(timerInterval);
    // Mark all agents as done
    document.querySelectorAll('.agent-node').forEach(n=>{
        n.classList.remove('waiting','running'); n.classList.add('done');
        n.querySelector('.agent-status').innerHTML='<span class="check-mark">&#10003;</span>';
    });
    [1,2,3,4].forEach(i=>{
        document.getElementById('pb'+i).classList.remove('active');
        document.getElementById('pb'+i).classList.add('done');
        document.getElementById('pp'+i).style.width='100%';
    });
    document.getElementById('agentCount').textContent='26';

    setTimeout(()=>{
        document.getElementById('pipelineSection').style.display='none';
        document.getElementById('resultsSection').style.display='block';

        // Score ring animation
        const score=data.score_final||0;
        const circumference=2*Math.PI*70; // ~440
        const offset=circumference-(score/100*circumference);
        const fill=document.getElementById('scoreRingFill');
        const color=score>=60?'var(--green)':score>=30?'#f59e0b':'#ef4444';
        fill.style.stroke=color;
        setTimeout(()=>{fill.style.strokeDashoffset=offset;},100);
        document.getElementById('scoreNum').textContent=score+'%';

        // Recommendation
        const reco=(data.recommandation||'').toLowerCase();
        const rb=document.getElementById('recoBox');
        if(reco.includes('contester')){rb.textContent='CONTESTER — Bonnes chances';rb.className='reco-box reco-contester';}
        else if(reco.includes('negocier')){rb.textContent='NEGOCIER — Reduction possible';rb.className='reco-box reco-negocier';}
        else{rb.textContent='PAYER — Faibles chances';rb.className='reco-box reco-payer';}

        // Details
        document.getElementById('resultDetails').innerHTML=[
            ['Dossier','#'+(data.dossier_uuid||'?')],
            ['Juridiction',data.juridiction||'?'],
            ['Confiance',(data.confiance||0)+'%'],
            ['Qualite',((data.supervision||{}).score_qualite||'?')+'%'],
            ['Temps',Math.round(data.temps_total||0)+'s'],
            ['Erreurs',data.nb_erreurs||0],
        ].map(([l,v])=>`<div class="result-row"><span class="result-label">${l}</span><span class="result-value">${v}</span></div>`).join('');

        // Arguments
        const phases=data.phases||{};
        const args=(phases.analyse?.analyste?.data?.arguments)||(data.arguments)||[];
        document.getElementById('argsList').innerHTML=args.length
            ?args.map((a,i)=>`<li style="animation-delay:${i*.1}s">${a}</li>`).join('')
            :'<li>Consultez un avocat pour une analyse approfondie</li>';

        // Etapes
        const rc=phases.livraison?.rapport_client||{};
        const etapes=rc.prochaines_etapes||[];
        document.getElementById('etapesList').innerHTML=etapes.length
            ?etapes.map((e,i)=>`<li style="animation-delay:${i*.1}s">${e}</li>`).join('')
            :'<li>Consultez un avocat specialise en droit routier</li>';

        // Resume
        document.getElementById('rapportResume').textContent=rc.resume||'Rapport en cours de generation...';

        // PDF link
        const pdfLink=document.getElementById('pdfLink');
        pdfLink.href=API_BASE+'/rapport/'+(data.dossier_uuid||'');

        // Stagger fade-in
        document.querySelectorAll('.results-section .card').forEach((c,i)=>{c.style.animationDelay=(i*.15)+'s';});
    },1500);
}

// ═══ DEMO MODE ═══
async function runDemo(){
    document.getElementById('btnAnalyze').disabled=true;
    document.getElementById('formCard').style.display='none';
    document.getElementById('pipelineSection').style.display='block';
    document.getElementById('resultsSection').style.display='none';
    runPipelineAnimation();
    try{
        const resp=await fetch(API_BASE+'/demo',{method:'POST',headers:{'Content-Type':'application/json'},body:'{}'});
        const data=await resp.json();
        showResults(data);
    }catch(err){
        alert('Erreur demo: '+err.message); resetForm();
    }
}

// ═══ RESET ═══
function resetForm(){
    document.getElementById('formCard').style.display='block';
    document.getElementById('pipelineSection').style.display='none';
    document.getElementById('resultsSection').style.display='none';
    document.getElementById('btnAnalyze').disabled=false;
    document.querySelectorAll('.agent-node').forEach(n=>{
        n.className='agent-node waiting';
        n.querySelector('.agent-status').innerHTML='';
    });
    [1,2,3,4].forEach(i=>{
        document.getElementById('pb'+i).className='phase-block';
        document.getElementById('pp'+i).style.width='0%';
    });
    ['flow1','flow2','flow3'].forEach(id=>{
        const el=document.getElementById(id); if(el) el.classList.remove('active');
    });
    document.querySelectorAll('.type-btn').forEach(b=>b.classList.remove('selected'));
    selectedType='';
    document.getElementById('scoreRingFill').style.strokeDashoffset=440;
    clearInterval(timerInterval);
}
</script>
</body>
</html>
